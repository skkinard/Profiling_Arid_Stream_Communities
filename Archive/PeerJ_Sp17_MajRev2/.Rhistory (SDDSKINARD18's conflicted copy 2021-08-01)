B <- matrix(7, nrow=7, ncol=5)
B
B <- matrix(7, nrow=5, ncol=7)
B
# Install Packages
install.packages("nlme")
install.packages("multcomp")
install.packages("bio.infer")
install.packages("vegan")
# Load Packages
library(nlme)
library(multcomp)
# Load Packages
library(nlme)
library(multcomp)
library(bio.infer)
library(vegan)
# Sean's PC loading packages
library("multcomp", lib.loc="~/R/win-library/3.5")
file.choose()
#Load Data
fish <- read.csv("C:/Users/Sean/Desktop/Dropbox/Research/Fish.Sept-Dec.Cycle 1-3_CSV.csv", header = TRUE, fileEncoding="UTF-8-BOM")
#Load Data
fish <- read.csv("/Users/Sean/Desktop/Dropbox/Research/Fish.Sept-Dec.Cycle 1-3_CSV.csv", header = TRUE, fileEncoding="UTF-8-BOM")
#Load Data
fish <- read.csv("/Users/seankinard/Dropbox/Research/Fish.Sept-Dec.Cycle 1-3_CSV.csv", header = TRUE, fileEncoding="UTF-8-BOM")
#Load Data
fish <- read.csv("/Users/seankinard/Dropbox/Research/TCAFS Conference/Fish.Sept-Dec.Cycle 1-3_CSV.csv", header = TRUE, fileEncoding="UTF-8-BOM")
head(fish)
fish[is.na(fish)] <- 0 # Filling an entry on SFC that had NA
# Ensure Pass data is read numerically
fish$pass1 <- as.numeric(fish$pass1)
fish$pass2 <- as.numeric(fish$pass2)
fish$pass3 <- as.numeric(fish$pass3)
fishsum <- aggregate(fish[,c(12,13,14)], by= list(fish$Site.Cycle), FUN = sum)
names(fishsum) <- c("Site.Cycle", "pass1","pass2","pass3")
head(fishsum)
# fit a model for each site and date that estimates the total abundance
fishsum$tot <- rep(0,length(fishsum[,1]))
fishsum$mtot <- rep(0,length(fishsum[,1]))
fishsum$coeff <- rep(0,length(fishsum[,1]))
# rep function creates replicates of value x, for vector length (here length(fishsum))
# Below is a loop function
for (x in 1:length(fishsum[,1])){
vec <- fishsum[x,2:4] #Creates a vector with passes 1-3
vecx <- c(0,as.numeric(vec[1]),(as.numeric(vec[1]) + as.numeric(vec[2]))) #Creates a vector with 0, p1, p1+p2
vecy <- c(as.numeric(vec[1]),as.numeric(vec[2]),as.numeric(vec[3])) # Creates a vector with p1, p2, p3
f1 <- summary(lm(vecy ~ vecx)) # Solve for CPUE least squares regression of [p1~0, p2~p1, and p3~p1+p2]
fishsum[x,6] <- (0-f1$coeff[1,1])/f1$coeff[2,1] # Solving for Total pop using regression [C=(-a)/b] where C is pop at CPUE=0, a is y intercept, and b is slope of CPUE
fishsum[x,5] <- sum(vecy) #sum caught
fishsum[x,7] <- f1$coeff[2,1] # slope
}
# 5 oddball sites
plot(mtot ~ tot, fishsum)
#The following sites have poor pop est using least squares regression due to catching more fish in pass 2 or 3 compared to pass 1.
odd <- which(fishsum$mtot>1500 | fishsum$mtot <0) # Produces vector of row #s containing erroroneous population estimates
oddballsites <- fishsum[which(fishsum$mtot>1500 | fishsum$mtot <0),]
oddballsites
# Create lm based on total catch ~ mtot excluding erroneous sites
f2 <- summary(lm(mtot ~ tot, fishsum[-odd,]))
f3 <- summary(lm(mtot ~ I(tot) + I(tot^2), fishsum[-odd,])) # I() is used to ensure that "^" is interpreted as an arithmetic rather than formula operator
# then apply that to all sites
fishsum$esttot <- f2$coeff[1,1] + f2$coeff[2,1]*fishsum[,5]
# create a new "final" abundance column. Here we use esttot (lm for all sites pop ~ total catch) for oddball sites and mtot (depletion pop estimates per site) for all other Site.Cycles
fishsum$ftot <- c(fishsum$esttot[1],fishsum$mtot[2:4],fishsum$esttot[5],fishsum$mtot[6:14],fishsum$esttot[15],fishsum$mtot[16:19],fishsum$esttot[20],fishsum$mtot[21:23],fishsum$esttot[24],fishsum$mtot[25:28])
# add together the passes into species abundance per site/date
fish$abun <- rowSums(fish[,12:14])
#attempting to create pop estimates for oddball sites based on pass 2 or 3 or sum(catch)
crap <- oddballsites
which(crap$pass1<crap$pass2) # all oddball sites have p2 > p1
which(crap$pass2<crap$pass3) # only AR1 has p1 < p2 < p3
fishmod1 <- summary(lm(mtot ~ pass1, fishsum[-odd,]))
fishmod1
fishsum$mtot[odd] <- fishmod1$coefficients[1,1] + fishmod1$coefficients[2,1]*fishsum$pass2[odd]
f4 <- summary(lm(mtot ~ tot, fishsum))
# New plot with oddball sites corrected via estimating abun via p2 as p1 calibrated by other site LSR abun ~ p1.
plot(mtot ~ tot, fishsum, main= "Depletion Population Estimates vs Total Catch")
abline(f4$coeff[1,1], f4$coeff[2,1], col="red")
# convert the original dataframe into a site x species matrix
benl <- fish[,c(4,11,16)] # Site.Cycle, Genus.Species, Abundance
names(benl) <- c("BenSampID", "FinalID", "Count")
bcnt.tax <- get.taxonomic(benl)
names(bcnt.tax)
bcnt.otu <- get.otu(bcnt.tax) # brings the data to the best common level (ie species or genus)
ss <- makess(bcnt.otu) # ss is the site x species matrix
# calculate the proportion of each taxa in each site in total
ss2 <- ss[,-1]/rowSums(ss[,-1]) # % of Site community matrix
ss2$Site.Cycle <- ss$BenSampID # add back row labels
# multiply out the proportions by the estimated totals
ss3 <- merge(fishsum[,c(1,9)],ss2, by = "Site.Cycle") # Merging ftot from fishsum dataframe with the site x %species dataframe
ss4 <- round(ss3[,-c(1,2)]*ss3$ftot) # multiplying % by ftot to get estimate abundance
ss4$Site.Cycle <- ss3$Site.Cycle #add back in the Site.Cycle column
ss4$shannon <- diversity(ss4[,1:29])
ss4$simpson <- diversity(ss4[,1:29], index = "simpson")
ss4$rich <- specnumber(ss4[,1:29])
(raremax <- min(rowSums(ss4[,1:29])))
ss4$rare.rich <- rarefy(ss4[,1:29], raremax)
ss4$abun <- rowSums(ss4[,1:29])
##################################################################
# OK so now we need some time series plots for each variable
mster <- merge(unique(fish[,c(1,2,3,4,5,6,7)]), ss4,by = "Site.Cycle")
# does unique() remove or merge duplicate rows? This merge is to combine date with our site x species matrix
# it is imperative not to include colums from fish that have unique values within each cycle
# Create a timeline vector
mster$Date <- apply(mster[,c('Year','Month','Day')],1,paste,sep='',collapse='-') # clarify this function. As far as I can tell, apply() is taking 3 columns, ?, pasting the values separated by a space which is then replaced by a dash?
mster$Date <- as.Date(mster$Date)
#qplot(Date,abun,data=mster,geom='line',color=SiteCode)
#qplot(Date,abun,data=mster,geom='line',color=SiteCode)
#qplot(Date,lnabun,data=mster,geom='line',color=SiteCode)
#qplot(Date,shannon,data=mster,geom='line',color=SiteCode)
#qplot(Date,simpson,data=mster,geom='line',color=SiteCode)
#qplot(Date,rich,data=mster,geom='line',color=SiteCode)
#qplot(Date,rare.rich,data=mster,geom='line',color=SiteCode)
#Unfamiliarity with qplot -> moving on to other plot strategies
#######################################################
mster$lnabun <- log(mster$abun)
nms1 <- metaMDS(mster[,9:37], k=2)
plot(nms1, disp = "sites", type = "n")
ordiellipse(nms1, mster$SiteCode, col=1:9, kind = "ehull", lwd=3)
ordispider(nms1, mster$SiteCode, col=1:9, label = TRUE)
#Site.Cycle points
#points(nms1, disp="sites", pch=21, col="red", bg="yellow", cex=1.3)
#Species names
text(nms1, display = "spec", cex=0.5, col="blue")
#Cycle #s
text(nms1$points[,1], nms1$points[,2], pos = 2, mster$Cycle)
# T-test of abundance differences between cycles
# We should to paired- t-test since the same sites were measure through time. We are testing the significance of site-dependent shifts in abundance.
# merge created unequal vectors of abundance per site.cycle from replication to fit species matrix
# solution: Create a data frame that I can run my t tests on. I'm running out of time so I will do this in excel and ask Chris at the meeting
install.packages("xlsx")
# library(xlsx)
library("xlsx", lib.loc="~/R/win-library/3.5")
write.xlsx(mster, "C:/Users/Sean/Desktop/Dropbox/Research/TCAFS Conference/mster.xlsx")
ss4$Cycle <- rep(1:3,9)
t.test(ss4[ss4$Cycle == 1,]$abun, ss4[ss4$Cycle == 2,]$abun, paired = TRUE)
# time 1 verse 2 is significant: t = -3.6539, df = 8, p-value = 0.006458
t.test(ss4[ss4$Cycle == 2,]$abun, ss4[ss4$Cycle == 3,]$abun, paired = TRUE)
t.test(ss4[ss4$Cycle == 1,]$shannon, ss4[ss4$Cycle == 2,]$shannon, paired = TRUE)
#ns: t = -2.2928, df = 8, p-value = 0.05104
t.test(ss4[ss4$Cycle == 1,]$simpson, ss4[ss4$Cycle == 2,]$simpson, paired = TRUE)
#ns: t = -2.2182, df = 8, p-value = 0.05734
t.test(ss4[ss4$Cycle == 1,]$rare.rich, ss4[ss4$Cycle == 2,]$rare.rich, paired = TRUE)
#####################################################
# This is an attempt to see marine species? This could be easily done in Excel using pivot table selections and abun over time
#mster$PerMarine <- rowSums(mster[,c(12,13,17,21,22,26,46,49,50,64)])/mster$abun
#qplot(Date,PerMarine,data=mster,geom='line',color=SiteCode)
#
mster$Site.Cycle2 <- mster$Site.Cycle
mster$nlnabun <- rep(0,27)
# calculate the deviation from mean ln abundance divided by mean ln abundance for each sampling date
#cyc <- c(1,2,3)
#for (x in 1:9){
#nab <- mean(mster[mster$SiteCode == site[x],]$lnabun)
#for (y in 1:3){
#mster[(x-1)*4+y,74]  <- (mster[mster$SiteCode == site[x] & mster$Cycle == cyc[y],]$lnabun -mnab)/mnab
#}
#}
#qplot(Date,nlnabun,data=mster,geom='line',color=SiteCode)
mster$Cycle1 <- as.factor(mster$Cycle)
f1 <- lme(lnabun ~ Cycle1, data = mster, random = ~1|SiteCode, corr = corAR1(form = ~1|SiteCode))
anova(f1)
# output
# numDF denDF  F-value p-value
# (Intercept)     1    16 736.9055  <.0001
# Cycle1          2    16   9.8930  0.0016
# Interpretation: sig dif of ln abun among cycles
summary(glht(f1, linfct=mcp(Cycle1 = "Tukey")))
# Output: Linear Hypotheses:
#              Estimate Std. Error    z value  Pr(>|z|)
#  2 - 1 == 0   1.3575       0.3119   4.353    < 1e-04 ***
#  3 - 1 == 0   1.1564       0.3568   3.241    0.00337 **
#  3 - 2 == 0  -0.2011       0.3119  -0.645    0.79443
# Interpretation: Cycle 2 and 3 log abundance is significantly higher than Cycle 1
# How does our analysis benefit from a log transformation of abundance?
f2 <- lme(simpson ~ Cycle1, data = mster, random = ~1|SiteCode, corr = corAR1(form = ~1|SiteCode))
anova(f2)
# Output
#               numDF denDF   F-value     p-value
# (Intercept)     1    16     159.27278   <.0001
# Cycle1          2    16     2.84326     0.0878
# Interpretation: Sig dif of alpha diversity among cycles
summary(glht(f1, linfct=mcp(Cycle1 = "Tukey")))
# Output:
#              Estimate    Std. Error  z value   Pr(>|z|)
#  2 - 1 == 0   1.3575     0.3119      4.353     < 0.001 ***
#  3 - 1 == 0   1.1564     0.3568      3.241     0.00338 **
#  3 - 2 == 0  -0.2011     0.3119     -0.645     0.79443
# Interpretation: Simpson index of diversity is sig higher for Cycle 2 and 3 compared to Cycle 1
plot(lnabun ~ Date, data = mster)
points(lnabun ~ Date, data = mster[mster$SiteCode == "TRC",], bg="red", pch=21, col="black")
points(lnabun ~ Date, data = mster[mster$SiteCode == "SFC",], bg="orangered", pch=21, col="black")
points(lnabun ~ Date, data = mster[mster$SiteCode == "AR",], pch=21, bg="orange",col="black" )
points(lnabun ~ Date, data = mster[mster$SiteCode == "PDC",], pch=21, bg="yellow",col="black")
points(lnabun ~ Date, data = mster[mster$SiteCode == "MR",], pch=21, bg="green3",col="black")
points(lnabun ~ Date, data = mster[mster$SiteCode == "GC",],  pch=21, bg="green2",col="black")
points(lnabun ~ Date, data = mster[mster$SiteCode == "PLC",],  pch=21, bg="green",col="black")
points(lnabun ~ Date, data = mster[mster$SiteCode == "WMC",],  pch=21, bg="blue",col="black")
points(lnabun ~ Date, data = mster[mster$SiteCode == "EMC",],  pch=21, bg="blue3",col="black")
View(mster)
example(boxplot)
?boxplot
colnames(mster)
boxplot(lnabun ~ Cycle, data=mster)
boxplot(lnabun ~ Cycle, data=mster, xlab="Months after Hurricane")
boxplot(lnabun ~ Cycle, data=mster, xlab="Months after Hurricane", ylab="ln of total abundance")
dateh <- as.data.frame(matrix(0,3,3))
names(dateh) <- c("Year", "Month","Day")
dateh[,1] <- c(2017,2017,2017)
dateh[,2]<- c(9,11,12)
dateh[,3] <- c(25,5,4)
dateh$Date <- apply(dateh[,c('Year','Month','Day')],1,paste,sep='',collapse='-')
dateh$Date <- as.Date(dateh$Date)
dateh$mlnab <- c(-0.1869, 0.05052, 0.08195)
dateh$stnlnab <- c(0.046089424,0.03675683,0.061843312)
lines(mlnab ~ Date, data=dateh, lwd=2)
arrows(dateh$Date, dateh$mlnab-dateh$stnlnab, dateh$Date, dateh$mlnab+dateh$stnlnab, length=0.05, angle=90, code=3)
adonis(mster[,8:36] ~ SiteCode*Cycle, data=mster, permutation=99)
#Residuals         9    1.4736    0.16373              0.18412
#Total             26   8.0034                         1.00000
#---
#  Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#
# Interpretation:
# adonis is Analysis of variance using distance matrices. We used species matrix for our distance matrix
# The community distances have R2 .53 between sites (p<.01). Cycle correlation with distance based on species matrix has R2 of .09 with pval<.01.
# Geographic differences correlate stronger with observed community differences than temporal differences.
# Is there anything else we can get from this PerMANOVA?
pairwise.adonis(mster[,8:36], factors = mster$SiteCode)
pairwise.adonis(mster[,8:36], factors = mster$Cycle)
# creating a vectorized pairwise comparison chart
temp <- unlist(as.data.frame(as.matrix(vegdist(mster[,8:36]))))
temp2 <- temp[temp > 0]
# creating vectors for the table
latvec <- 1
latv <- mster$Cycle
for (x in 1:length(mster[,1])){
latvec <- c(latvec,rep(latv[[x]],(length(mster[,1])-1)))
}
latvec2 <- 1
for (x in 1:length(mster[,1])){
latvec2 <- c(latvec2,latv[-x])
}
sitevec <- 1
sitev <- as.character(mster$SiteCode)
for (x in 1:length(mster[,1])){
sitevec <- c(sitevec,rep(sitev[[x]],(length(mster[,1])-1)))
}
sitevec2 <- 1
for (x in 1:length(mster[,1])){
sitevec2 <- c(sitevec2,sitev[-x])
}
cycle.compare <- as.data.frame(cbind(temp2,sitevec[-1],sitevec2[-1],latvec[-1],latvec2[-1]))
# selecting the "within site" comparisons
cco <- cycle.compare[cycle.compare$V2 == cycle.compare$V3,]
# creating a new column for unique comparisons
cco$comp <- paste(cco$V4,".",cco$V5)
cco$temp2 <- as.numeric(paste(cco$temp2))
cco1 <- cco[cco$comp == "1 . 2"| cco$comp =="1 . 3"| cco$comp =="2 . 3",]
summary(aov(temp2 ~ comp, cco1))
TukeyHSD(aov(temp2 ~ comp, cco1))
# 95% family-wise confidence level
#
# Fit: aov(formula = temp2 ~ comp, data = cco1)
#
# $`comp`
#                   diff        lwr        upr     p adj
# 1 . 3-1 . 2  0.007715443 -0.2601269 0.27555778 0.9971514
# 2 . 3-1 . 2 -0.213810609 -0.4816529 0.05403173 0.1354888
# 2 . 3-1 . 3 -0.221526052 -0.4893684 0.04631629 0.1185342
#Interpretation: No sig differences among pairwise comparrisons of compositional shifts cycle 1-3
boxplot(temp2 ~ comp, cco1)
dateh <- as.data.frame(matrix(0,3,3))
names(dateh) <- c("Year", "Month","Day")
dateh[,1] <- c(2017,2017,2017)
dateh[,2]<- c(9,11,12)
dateh[,3] <- c(25,5,4)
dateh$Date <- apply(dateh[,c('Year','Month','Day')],1,paste,sep='',collapse='-')
dateh$Date <- as.Date(dateh$Date)
dateh$mlnab <- c(-0.1869, 0.05052, 0.08195)
dateh$stnlnab <- c(0.046089424,0.03675683,0.061843312)
lines(mlnab ~ Date, data=dateh, lwd=2)
arrows(dateh$Date, dateh$mlnab-dateh$stnlnab, dateh$Date, dateh$mlnab+dateh$stnlnab, length=0.05, angle=90, code=3)
adonis(mster[,8:36] ~ SiteCode*Cycle, data=mster, permutation=99)
# Output:
# Call:
#  adonis(formula = mster[, 8:36] ~ SiteCode * Cycle, data = mster,      permutations = 99)
#
#Permutation: free
#Number of permutations: 99
#
#Terms added sequentially (first to last)
#
#                  Df   SumsOfSqs MeanSqs   F.Model      R2      Pr(>F)
# SiteCode         8    4.2553    0.53192   3.2487     0.53169   0.01 **
#  Cycle           1    0.7155    0.71553   4.3701     0.08940   0.01 **
#  SiteCode:Cycle  8    1.5590    0.19487   1.1902     0.19479   0.19
#Residuals         9    1.4736    0.16373              0.18412
#Total             26   8.0034                         1.00000
#---
#  Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#
# Interpretation:
# adonis is Analysis of variance using distance matrices. We used species matrix for our distance matrix
# The community distances have R2 .53 between sites (p<.01). Cycle correlation with distance based on species matrix has R2 of .09 with pval<.01.
# Geographic differences correlate stronger with observed community differences than temporal differences.
# Is there anything else we can get from this PerMANOVA?
pairwise.adonis(mster[,8:36], factors = mster$SiteCode)
#output
#pairs   F.Model         R2 p.value p.adjusted sig
#1   AR vs EMC 3.6251410 0.47541954     0.1          1
#2    AR vs GC 1.8514470 0.31640840     0.1          1
#3    AR vs MR 2.7956253 0.41138603     0.1          1
#4   AR vs PDC 2.9644713 0.42565633     0.2          1
#5   AR vs PLC 1.0194353 0.20309760     0.4          1
#6   AR vs SFC 4.2009133 0.51224945     0.1          1
#7   AR vs TRC 6.0705415 0.60280190     0.1          1
#8   AR vs WMC 1.0747795 0.21178842     0.5          1
#9   EMC vs GC 1.2508874 0.23822399     0.4          1
#10  EMC vs MR 2.0152437 0.33502279     0.1          1
#11 EMC vs PDC 4.7933415 0.54511036     0.1          1
#12 EMC vs PLC 1.6240824 0.28877286     0.2          1
#13 EMC vs SFC 5.5474636 0.58104056     0.1          1
#14 EMC vs TRC 6.4622299 0.61767233     0.1          1
#15 EMC vs WMC 1.0721248 0.21137586     0.5          1
#16   GC vs MR 1.5211112 0.27550817     0.1          1
#17  GC vs PDC 1.4339022 0.26388075     0.2          1
#18  GC vs PLC 1.0479175 0.20759402     0.5          1
#19  GC vs SFC 3.5365436 0.46925272     0.1          1
#20  GC vs TRC 3.9738018 0.49835724     0.1          1
#21  GC vs WMC 0.3493742 0.08032747     0.5          1
#22  MR vs PDC 2.7295038 0.40560253     0.1          1
#23  MR vs PLC 1.6424723 0.29109089     0.1          1
#24  MR vs SFC 0.9974800 0.19959660     0.5          1
#25  MR vs TRC 1.0950625 0.21492622     0.5          1
#26  MR vs WMC 1.3723718 0.25544990     0.2          1
#27 PDC vs PLC 2.8035271 0.41206966     0.1          1
#28 PDC vs SFC 5.2074986 0.56557148     0.1          1
#29 PDC vs TRC 6.1338172 0.60528201     0.1          1
#30 PDC vs WMC 1.3383749 0.25070830     0.2          1
#31 PLC vs SFC 4.3389585 0.52032379     0.1          1
#32 PLC vs TRC 4.9818839 0.55465913     0.1          1
#33 PLC vs WMC 0.5175928 0.11457269     0.8          1
#34 SFC vs TRC 1.5123863 0.27436145     0.3          1
#35 SFC vs WMC 3.0870511 0.43559035     0.1          1
#36 TRC vs WMC 3.5710856 0.47167418     0.1          1
# Interpretation: No pval <.05. Highest R2 by sites are ~.60 involving pairwise comparrisons between PDC and TRC and AR vs TRC and EMC vs SFC.
pairwise.adonis(mster[,8:36], factors = mster$Cycle)
# Output
#    pairs  F.Model         R2     p.value  p.adjusted sig
# 1 1 vs 2 2.213256 0.12151897   0.040       0.120
# 2 1 vs 3 2.352984 0.12820715   0.025       0.075
# 3 2 vs 3 0.589230 0.03551883   0.777       1.000
#Interpretation: sig dif between 1 and 2, 1 and 3, but not 2 and 3. P adjusted suggests that there is not sig diff based on pairwise comparrison of cycle 1 and 2.
# creating a vectorized pairwise comparison chart
temp <- unlist(as.data.frame(as.matrix(vegdist(mster[,8:36]))))
temp2 <- temp[temp > 0]
# creating vectors for the table
latvec <- 1
latv <- mster$Cycle
for (x in 1:length(mster[,1])){
latvec <- c(latvec,rep(latv[[x]],(length(mster[,1])-1)))
}
latvec2 <- 1
for (x in 1:length(mster[,1])){
latvec2 <- c(latvec2,latv[-x])
}
sitevec <- 1
sitev <- as.character(mster$SiteCode)
for (x in 1:length(mster[,1])){
sitevec <- c(sitevec,rep(sitev[[x]],(length(mster[,1])-1)))
}
sitevec2 <- 1
for (x in 1:length(mster[,1])){
sitevec2 <- c(sitevec2,sitev[-x])
}
cycle.compare <- as.data.frame(cbind(temp2,sitevec[-1],sitevec2[-1],latvec[-1],latvec2[-1]))
# selecting the "within site" comparisons
cco <- cycle.compare[cycle.compare$V2 == cycle.compare$V3,]
# creating a new column for unique comparisons
cco$comp <- paste(cco$V4,".",cco$V5)
cco$temp2 <- as.numeric(paste(cco$temp2))
cco1 <- cco[cco$comp == "1 . 2"| cco$comp =="1 . 3"| cco$comp =="2 . 3",]
summary(aov(temp2 ~ comp, cco1))
# Output
#              Df   Sum Sq  Mean Sq   F value  Pr(>F)
# comp         2   0.2845   0.14227   2.748    0.0842 .
# Residuals   24   1.2424   0.05176
# Interpretation: Compositional shifts by pairwise comparrisons of cycles 1-3 is not sig with pval=.08
TukeyHSD(aov(temp2 ~ comp, cco1))
# Output:
# Tukey multiple comparisons of means
# 95% family-wise confidence level
#
# Fit: aov(formula = temp2 ~ comp, data = cco1)
#
# $`comp`
#                   diff        lwr        upr     p adj
# 1 . 3-1 . 2  0.007715443 -0.2601269 0.27555778 0.9971514
# 2 . 3-1 . 2 -0.213810609 -0.4816529 0.05403173 0.1354888
# 2 . 3-1 . 3 -0.221526052 -0.4893684 0.04631629 0.1185342
#Interpretation: No sig differences among pairwise comparrisons of compositional shifts cycle 1-3
boxplot(temp2 ~ comp, cco1)
# Pairwise comparrisons of compositions of fish cycle 1-3 indicate evidence of shift 1 vs 3.
View(temp2)
# 95% family-wise confidence level
#
# Fit: aov(formula = temp2 ~ comp, data = cco1)
#
# $`comp`
#                   diff        lwr        upr     p adj
# 1 . 3-1 . 2  0.007715443 -0.2601269 0.27555778 0.9971514
# 2 . 3-1 . 2 -0.213810609 -0.4816529 0.05403173 0.1354888
# 2 . 3-1 . 3 -0.221526052 -0.4893684 0.04631629 0.1185342
#Interpretation: No sig differences among pairwise comparrisons of compositional shifts cycle 1-3
boxplot(temp2 ~ comp, cco1)
TukeyHSD(aov(temp2 ~ comp, cco1))
summary(aov(temp2 ~ comp, cco1))
file.choose
file.choose()
# Set Work Directory MACBOOK
setwd("/Users/seankinard/Dropbox/Research/Data Analysis/SKK_Fish_Workspace/HHF_R_Stats/HHF_R_Stats.R")
getwd()
1*diag(2)
install.packages("Hmisc")
install.packages("Hmisc")
install.packages("Hmisc")
# Load Packages
library(ggplot2)
library(dplyr)
library(gridExtra)
library(Hmisc)
library("writexl")
install.packages("writexl")
ibrary(tidyverse)
library(gridExtra)
library(Hmisc)
library("writexl")
library(iNEXT)
library(nlme)
library(multcomp)
library("car")
library("MuMIn")
library("readr")
library(car)
library(MASS)
file.choose()
setwd("/Users/seankinard/Dropbox/Research/Manuscipts/Diss.2_Gradient/PeerJ_Sp17_MajRev2")
fish <- read_csv("sp17_data_files/sp17_site_x_fish.csv")
View(fish)
f_nosite <- select(fish, -site.code, -STAID)
colnames(fish)
select(fish, -site.code, -STAID)
f_nosite <- fish[,-c(1:2)]
# calculate diversity metrics
i_fish <- iNEXT(as.data.frame(t(f_nosite))) #create iNEXT object
ggiNEXT(i_fish) #plot rarefaction curves
#Extract Hill numbers from iNEXT object
fish$rich <- i_fish$AsyEst[c(which(i_fish$AsyEst$Diversity == "Species richness")),4]
fish$rich.s.e <- i_fish$AsyEst[c(which(i_fish$AsyEst$Diversity == "Species richness")),5]
fish$shannon <- i_fish$AsyEst[c(which(i_fish$AsyEst$Diversity == "Shannon diversity")),4]
fish$shannon.s.e <- i_fish$AsyEst[c(which(i_fish$AsyEst$Diversity == "Shannon diversity")),5]
fish$simpson <- i_fish$AsyEst[c(which(i_fish$AsyEst$Diversity == "Simpson diversity")),4]
fish$simpson.s.e <- i_fish$AsyEst[c(which(i_fish$AsyEst$Diversity == "Simpson diversity")),5]
# Load environmental data
env <- read_csv("sp17_data_files/sp17_site_x_env.csv")
# Rename natrices for multiple regression script
fmat <- fish
emat <- env
# cleaning up data frames to include only the a priori selected variables and community abundance matrix
(env <- select(emat, STAID, AP, flash.index, LFPP, NH4., log.cond, canopy, Rosgen.Index))
library(tidyverse)
# cleaning up data frames to include only the a priori selected variables and community abundance matrix
(env <- select(emat, STAID, AP, flash.index, LFPP, NH4., log.cond, canopy, Rosgen.Index))
# Merge dataframes to ensure matching rows (sites)
msterfish <- merge(env,fmat, by = "STAID")
# Merge dataframes to ensure matching rows (sites)
msterfish <- merge(env,fish, by = "STAID")
colnames(msterfish)
full.model.fish <- lm(rich~ AP + flash.index + LFPP + NH4. + log.cond + Rosgen.Index , data=msterfish)
summary(full.model.fish)
vif(full.model.fish) # Indicates low variance inflation due to colinearities among environmental predictors
options(na.action = "na.fail")
ms1 <- dredge(full.model.fish)
options(na.action = "na.omit")
ms1
ms1
# average models with delta.aicc < 4
summary(model.avg(ms1, subset = delta < 4))
head(msterfish)
full.model.fish <- lm(rich~ AP + flash.index + LFPP + NH4. + log.cond + Rosgen.Index , data=msterfish[-7,])
summary(full.model.fish)
vif(full.model.fish) # VIF is okay, but warrants some concern regarding Precipiation (10.46) along with conductivity (8.23)
options(na.action = "na.fail")
options(na.action = "na.fail")
ms1 <- dredge(full.model.fish)
options(na.action = "na.omit")
ms1
full.model.fish <- lm(rich~ AP + flash.index + LFPP + NH4. + log.cond + Rosgen.Index , data=msterfish[-7,])
summary(full.model.fish)
vif(full.model.fish) # VIF is okay, but warrants some concern regarding Precipiation (10.8) along with conductivity (8.8)
options(na.action = "na.fail")
ms1 <- dredge(full.model.fish)
fishdat <- msterfish[-7,]
full.model.fish <- lm(rich~ AP + flash.index + LFPP + NH4. + log.cond + Rosgen.Index , data=fishdat)
summary(full.model.fish)
vif(full.model.fish) # VIF is okay, but warrants some concern regarding Precipiation (10.8) along with conductivity (8.8)
options(na.action = "na.fail")
ms1 <- dredge(full.model.fish)
options(na.action = "na.omit")
ms1
ms1
